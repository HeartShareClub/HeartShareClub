"use strict";var app=angular.module("heartShareClubApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]);app.constant("FIREBASE_URL","https://heartshareclub.firebaseio.com/"),app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/homepage.html",controller:"HomepageCtrl"}).when("/posts/:postId",{templateUrl:"views/showpost.html",controller:"PostViewCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"AuthCtrl",resolve:{user:["Auth",function(a){return a.resolveUser()}]}}).when("/preregister",{templateUrl:"views/preregister.html",controller:"PreregisterCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl",resolve:{user:["Auth",function(a){return a.resolveUser()}]}}).when("users/:userId",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/reward",{templateUrl:"views/reward.html",controller:"RewardCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("PostsCtrl",["$scope","$location","Post","Auth",function(a,b,c,d){a.posts=c.all,a.user=d.user,a.post={url:"http://",title:""},a.deletePost=function(a){c["delete"](a)}}]),app.factory("Post",["$firebase","FIREBASE_URL",function(a,b){var c=new Firebase(b),d=a(c.child("posts")).$asArray(),e={all:d,create:function(b){return d.$add(b).then(function(d){return a(c.child("user_posts").child(b.creatorUID)).$push(d.name()),d})},get:function(b){return a(c.child("posts").child(b)).$asObject()},"delete":function(a){return d.$remove(a)},comments:function(b){return a(c.child("comments").child(b)).$asArray()}};return e}]),app.controller("PostViewCtrl",["$scope","$routeParams","Post","Auth",function(a,b,c,d){a.post=c.get(b.postId),a.comments=c.comments(b.postId),a.user=d.user,a.signedIn=d.signedIn,a.addComment=function(){if(a.commentText&&""!==a.commentText){var b={text:a.commentText,creator:a.user.profile.email,creatorUID:a.user.uid};a.comments.$add(b),a.commentText=""}}}]),app.controller("NavCtrl",["$scope","$location","Post","Auth",function(a,b,c,d){a.post={url:"http://",title:""},a.signedIn=d.signedIn,a.logout=d.logout,a.user=d.user,a.submitPost=function(){a.post.creator=a.user.profile.email,a.post.creatorUID=a.user.uid,c.create(a.post).then(function(c){b.path("/posts/"+c.name()),a.post={url:"http://",title:""}})}}]),app.filter("hostnameFromUrl",function(){return function(a){var b=document.createElement("a");return b.href=a,b.hostname}}),app.controller("AuthCtrl",["$scope","$location","Auth","user",function(a,b,c,d){d&&b.path("/"),a.login=function(){c.login(a.user).then(function(){b.path("/")},function(b){a.error=b.toString()})},a.register=function(){c.register(a.user).then(function(){return c.login(a.user).then(function(b){return b.email=a.user.email,b.first_name=a.user.first_name,b.last_name=a.user.last_name,c.createProfile(b)}).then(function(){b.path("/")})["catch"](function(b){a.error=b.toString()})})}}]),app.factory("Auth",["$firebaseAuth","$firebase","FIREBASE_URL","$rootScope",function(a,b,c,d){var e=new Firebase(c),f=a(e),g={register:function(a){return f.$createUser({email:a.email,password:a.password},function(a,b){if(!a)return console.log("Successfully created user account with uid:",b.uid),b;switch(a.code){case"EMAIL_TAKEN":return console.log("The new user account cannot be created because the email is already in use."),null;case"INVALID_EMAIL":return console.log("The specified email is not a valid email."),null;default:return console.log("Error creating user:",a),null}})},createProfile:function(a){var c={email:a.email,first_name:a.first_name,last_name:a.last_name},d=b(e.child("profile"));return d.$set(a.uid,c)},login:function(a){return f.$authWithPassword({email:a.email,password:a.password}).then(function(a){return console.log("Authenticated successfully with payload:",a),d.$broadcast("$firebaseAuth:authWithPassword",a),a})["catch"](function(a){throw console.log("Login Failed!",a),a})},logout:function(){f.$unauth(),d.$broadcast("$firebaseAuth:unauth")},resolveUser:function(){return f.$waitForAuth()},signedIn:function(){return f.$getAuth()},user:{}};return d.$on("$firebaseAuth:authWithPassword",function(a,c){angular.copy(c,g.user),g.user.profile=b(e.child("profile").child(g.user.uid)).$asObject()}),d.$on("$firebaseAuth:unauth",function(){console.log("logged out"),g.user&&g.user.profile&&g.user.profile.$destroy(),angular.copy({},g.user)}),g}]),app.controller("RewardCtrl",["$firebase","FIREBASE_URL","$scope","$routeParams",function(a,b,c){var d="ad0d3812e49a56ff3e402953e37d614a",e=new Kiip(d);c.redeemReward=function(){e.postMoment("helpingCharity")},c.secondReward=function(){e.postMoment("comingBack")}}]);